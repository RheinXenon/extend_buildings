# 居民署（Resident Office）建筑设计

## 建筑概况

**建筑名称**: 居民署 (resident_office)
**建筑类型**: 基础设施建筑
**主要功能**: 提高人口增长率
**实现方式**: 三级建筑升级系统
**最大等级**: 3级
**解锁条件**: 所有等级游戏开始时即可用

## 设计理念

居民署作为一个管理和服务居民的行政建筑，其主要目标是促进人口增长。通过建筑等级升级，可以提供更好的服务和更显著的效果。

### 为什么改用建筑等级而非生产方式？

原方案使用三种不同的生产方式来提供不同效果，但由于游戏机制限制，切换生产方式无法实际改变人口增长效果。因此改为使用建筑等级系统：

1. **三个建筑等级**：每个等级提供递增的效果
2. **统一维护方式**：所有等级使用相同的生产方式，但资源消耗随等级递增
3. **游戏开始即可升级**：所有建筑等级从游戏开始就解锁，无需科技
4. **效果直接绑定建筑等级**：通过modifier_level_2和modifier_level_3实现

## 参考案例分析

### 1. 殖民地建筑（settlement_building）

- **资源消耗**: stone 0.1, lumber 0.1, wild_game 0.1, wool 0.1
- **效果**: local_population_growth = 0.01
- **特点**: 边疆殖民地，资源消耗较为基础

### 2. 灌溉系统（irrigation_systems）

- **资源消耗**: tools 0.1
- **效果**: local_population_capacity = 1.0, local_monthly_food_modifier = 0.05
- **特点**: 简单维护，主要靠工具

### 3. 医院（hospital_maintenance）

- **资源消耗**: fiber_crops 0.1, tools 0.02, medicaments 0.02, mercury 0.01
- **特点**: 多样化资源消耗，涉及医疗设施

### 4. 修道院（monastery_maintenance）

- **资源消耗**: glass 0.025, cloth 0.025, beer 0.1, beeswax 0.05
- **特点**: 文化和宗教建筑，消耗精细物品

## 建筑等级设计

### 等级一：基础居民服务

**效果**:
- **人口增长**: +0.5% (0.003固定 + 0.002×1缩放)
- **疾病抗性**: +3% (0.03×1缩放)

**资源消耗**:
- lumber = 0.1
- tools = 0.1  
- cloth = 0.1

**设计理由**:
- 提供基础的行政管理和居民服务
- 使用基本材料维护设施和满足居民基本需求
- 总消耗0.3单位，体现基础行政建筑的维护成本

---

### 等级二：改进居民服务

**解锁条件**: 游戏开始即可用

**效果**:
- **人口增长**: +0.7% (0.003固定 + 0.002×2缩放)
- **疾病抗性**: +6% (0.03×2缩放)

**资源消耗**:
- lumber = 0.2 (0.1×2缩放)
- tools = 0.2 (0.1×2缩放)
- cloth = 0.2 (0.1×2缩放)

**设计理由**:
- 通过更多的设备和更好的物资提供改进的居民服务
- 增加疾病抗性体现更好的公共卫生管理
- 资源消耗随等级自动翻倍，适合经济发达的地区

---

### 等级三：高级人口管理

**解锁条件**: 游戏开始即可用

**效果**:
- **人口增长**: +0.9% (0.003固定 + 0.002×3缩放)
- **疾病抗性**: +9% (0.03×3缩放)

**资源消耗**:
- lumber = 0.3 (0.1×3缩放)
- tools = 0.3 (0.1×3缩放)
- cloth = 0.3 (0.1×3缩放)

**设计理由**:
- 最全面的人口管理方案，使用高质量设施和工具
- 显著的疾病抗性提升体现先进的公共卫生系统
- 资源消耗随等级自动增长为三倍，适合富裕的城市地区

---

## 实施方案总结

采用**三级建筑升级系统**：

1. **所有等级游戏开始即解锁**：无需科技或进度要求
2. **效果递增**：人口增长从0.5%提升到0.9%，疾病抗性从3%提升到9%
3. **资源消耗递增**：从0.3总消耗提升到0.9总消耗（线性增长）
4. **技术实现**：使用raw_modifier（固定值）+ modifier（乘以等级）组合

## 与游戏机制的适配性

### 优点：

1. **解决机制限制**: 使用建筑等级而非生产方式切换，避免游戏机制问题
2. **资源多样性**: 消耗的资源类型合理，都是基础且常见的物资
3. **成本平衡**: 总消耗量与同类建筑相当，随等级递增合理
4. **逻辑合理**: 所有消耗资源都与人口管理和居民服务直接相关
5. **不产出商品**: 建筑的价值在于人口增长buff而非物质产出
6. **即时可用**: 所有等级游戏开始就解锁，玩家可根据需求和资源状况选择升级

### 注意事项：

1. **平衡性测试**: 建议在游戏中测试，确保不会破坏经济平衡
2. **地区适用性**: 基础等级适用于大多数地区，避免过于依赖稀有资源
3. **升级成本**: 玩家需要权衡升级成本和效果收益
4. **资源供应**: 高等级建筑需要更多资源，确保供应链充足

## 实现代码参考

### 建筑定义 (resident_office.txt)

```
resident_office = {
    is_foreign = no
    max_levels = 3  # 三个建筑等级
    pop_type = peasants
  
    category = infrastructure_category
    employment_size = tiny_rural_peasant_produce_employment
  
    rural_settlement = yes
    town = yes
    city = yes
  
    location_potential = {
        location_population_percentage < 0.60
    }
    remove_if = {
        location = {
            location_population_percentage > 0.60
        }
    }
  
    possible_production_methods = {
        resident_office_maintenance
    }
  
    construction_demand = colony_construction
    build_time = village_build_time
  
    # 固定效果（不随等级缩放）
    raw_modifier = {
        local_population_growth = 0.003  # 固定0.3%
    }
  
    # 缩放效果（乘以建筑等级）
    # Level 1: 0.003 + 0.002*1 = 0.5%, 3%疾病抗性
    # Level 2: 0.003 + 0.002*2 = 0.7%, 6%疾病抗性
    # Level 3: 0.003 + 0.002*3 = 0.9%, 9%疾病抗性
    modifier = {
        local_population_growth = 0.002  # 每级+0.2%
        local_disease_resistance = 0.03  # 每级+3%
    }
}
```

### 生产方式定义 (resident_office_production_methods.txt)

```
resident_office_maintenance = {
    # 基础资源消耗（会自动乘以建筑等级）
    # Level 1: 0.1 each = 0.3 total
    # Level 2: 0.2 each = 0.6 total
    # Level 3: 0.3 each = 0.9 total
    lumber = 0.1
    tools = 0.1
    cloth = 0.1
  
    category = building_maintenance
}
```

### 关键改动说明

1. **max_levels = 3**: 允许建筑升级到三级
2. **raw_modifier**: 固定效果，不随等级缩放
3. **modifier**: 缩放效果，会自动乘以建筑等级
4. **生产方式资源消耗**: 会自动乘以建筑等级（EU5机制）
5. **无解锁条件**: 所有等级默认可用，无需科技或进度解锁

### EU5建筑等级机制说明

在Europa Universalis V中：
- **modifier**: 会自动乘以建筑等级和goods access
- **raw_modifier**: 不会缩放，所有等级效果相同
- **生产方式不支持modifier**: 只能定义资源输入/输出
- **资源消耗自动缩放**: 生产方式中定义的资源消耗会自动乘以建筑等级

因此，要实现非线性的效果增长，需要使用raw_modifier（固定基础值）+ modifier（按等级缩放）的组合。
