# 城乡结合部（Urban-Rural Junction）建筑设计

## 建筑概况

**建筑名称**: 城乡结合部 (urban_rural_junction)
**建筑类型**: 基础设施建筑
**主要功能**: 增加地区可用建筑等级（建筑槽位）
**建筑等级**: 动态计算（基于发展度和人口）
**解锁条件**: 游戏开始时即可用

## 设计理念

城乡结合部代表城市与乡村交界处的过渡区域，这些区域具有较高的土地利用效率，可以支持更多建筑的建设。通过建设更多的城乡结合部，能够扩大城市/集镇的建设容量，允许玩家建造更多建筑。

### 核心机制

1. **可用建筑等级扩展**：每级城乡结合部增加10个可用建筑等级（free_building_levels）
2. **动态上限**：建筑最高等级由发展度和人口动态计算
3. **农民驱动**：依靠农民阶层来运营和维护
4. **资源消耗**：需要持续消耗砖石和工具维护基础设施

## 功能设计

### 主要效果

- **可用建筑等级增加**: +10 / 级（使用 `free_building_levels`）
- **适用范围**: 城市 (city) 和集镇 (town)，不适用于农村聚落 (rural_settlement)
- **执行阶层**: 农民 (peasants)
- **人力需求**: 250人 / 级（tiny_rural_peasant_produce_employment）

### 资源消耗

**维护成本** (每级):

- 砖石 (masonry): 0.1
- 工具 (tools): 0.1

**设计理由**:

- 砖石用于道路、地基等基础设施建设
- 工具用于日常维护和施工作业
- 总消耗0.2单位，体现基础设施的维护成本

## 建筑上限设计

### 实际实现的上限计算方式

建筑数量上限采用**动态计算公式**，综合考虑发展度和人口规模：

```
max_levels = {
    add = {
        desc = "BUILDING_LEVEL_BASE"
        value = 1  # 基础1级
    }
    add = {
        desc = "BUILDING_LEVEL_DEVELOPMENT"
        value = development
        multiply = 0.1  # 发展度 × 0.1
    }
    add = {
        desc = "BUILDING_LEVEL_POPULATION"
        value = population
        multiply = 0.05  # 人口 × 0.05
    }
}
```

**计算示例**：
- 发展度10，人口100：最大等级 = 1 + (10 × 0.1) + (100 × 0.05) = 1 + 1 + 5 = 7级
- 发展度20，人口200：最大等级 = 1 + (20 × 0.1) + (200 × 0.05) = 1 + 2 + 10 = 13级

### 建筑限制

- **仅限城市和集镇**: 不适用于农村聚落
- **动态上限**: 随着发展度和人口增长，可建造更多等级
- **多因素影响**: 同时考虑发展水平和人口规模

## 游戏平衡性考虑

### 优点

1. **扩展性**: 为玩家提供更多建筑空间，提升游戏策略深度
2. **发展与人口双驱动**: 鼓励发展度提升和人口增长，符合城市发展逻辑
3. **资源平衡**: 消耗基础资源，不会破坏经济平衡
4. **阶层应用**: 为农民阶层提供额外的就业岗位

### 平衡考虑

1. **建筑等级增长**: +10可用建筑等级/级是显著效果，动态上限确保平衡
2. **发展与人口要求**: 高等级建筑需要发展度和人口支撑
3. **成本收益**: 玩家需权衡维护成本与额外建筑槽位的价值
4. **游戏进程**: 动态上限避免早期过度扩张，保持游戏挑战性

## 实现要点

### 建筑定义（实际代码）

```
urban_rural_junction = {
    is_foreign = no
    
    # 动态计算最大等级
    max_levels = {
        add = {
            desc = "BUILDING_LEVEL_BASE"
            value = 1
        }
        add = {
            desc = "BUILDING_LEVEL_DEVELOPMENT"
            value = development
            multiply = 0.1
        }
        add = {
            desc = "BUILDING_LEVEL_POPULATION"
            value = population
            multiply = 0.05
        }
    }
    
    pop_type = peasants
    category = infrastructure_category
    employment_size = tiny_rural_peasant_produce_employment  # 250人/级
    
    # 仅限城市和集镇
    rural_settlement = no
    town = yes
    city = yes
    
    build_time = infrastructure_build_time
    
    # 单一维护生产方式
    possible_production_methods = {
        urban_rural_junction_maintenance
    }
    
    construction_demand = town_building_construction
    
    # 每级增加10个可用建筑等级
    modifier = {
        free_building_levels = 10
    }
}
```

### 生产方式定义（实际代码）

```
urban_rural_junction_maintenance = {
    # 资源消耗随建筑等级自动缩放
    # 1级: 各0.1
    # 2级: 各0.2
    # 3级+: 以此类推
    masonry = 0.1   # 砖石用于基础设施
    tools = 0.1     # 工具用于维护
    
    category = building_maintenance
}
```

## 技术说明

### 关键机制

1. **free_building_levels vs local_building_slots**：
   - 使用 `free_building_levels` 增加可用建筑等级
   - 这是正确的EU5属性名称，不是 `local_building_slots`

2. **动态max_levels计算**：
   - 使用 `max_levels` 块而非 `max_level_at_location`
   - 综合考虑发展度和人口，提供更灵活的上限

3. **资源名称**：
   - 使用 `masonry`（砖石）而非 `bricks`
   - 符合EU5的资源命名规范

4. **自动缩放**：
   - 生产方式中的资源消耗自动乘以建筑等级
   - modifier中的效果自动乘以建筑等级

## 本地化命名建议

- **英文**: Urban-Rural Junction
- **中文**: 城乡结合部
- **描述**: 城市与乡村的过渡区域，提供额外的建筑用地，扩大城市建设容量。

## 测试建议

1. 在不同发展度和人口规模的城市测试
2. 验证可用建筑等级确实增加
3. 检查资源消耗是否随等级正确缩放
4. 确认建筑上限随发展度和人口动态变化
